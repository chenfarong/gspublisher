{"version":3,"sources":["../../../../assets/Script/assets/Script/Gm.js"],"names":["AConfig","require","cc","Class","extends","Component","properties","WsHost","EditBox","CmdSend","CmdResult","Recv","LastCmdName","RecvCount","LabRecvCount","Label","GmJson","default","type","JsonAsset","ScrollItem","Prefab","ScrollCmd","ScrollView","netEvent","event","msg","cmdline","JSON","stringify","TxLog","string","text","console","log","cmd","toString","_onGmCmdClick","tar","note","GmInsert","title","item","instantiate","sc","getComponent","SetData","content","addChild","onLoad","XNet","EarAdd","loader","loadRes","err","jsonAsset","_onAfterGmJsonDBLoaded","bind","LoadFromFile","_onAfterGmConfig","arg","v","RowFeildValueFirstEx","i","Count","o","RowObject","NAME","CMDLINE","NOTE","start","Array","isArray","json","length","j","ClickConnect","Close","Host","Open","ClickDisconnect","ClickWsLibrary","ClickCmdSend","parse","Send","e","message","ClickScrollItem"],"mappings":"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","file":"Gm.js","sourceRoot":"../../../../assets/Script","sourcesContent":["import { XNet, XNetEvent } from \"./Network\";\n//import \"./Config\";\nvar AConfig = require(\"Config\");\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    WsHost: cc.EditBox,\n    CmdSend: cc.EditBox,\n    CmdResult: cc.EditBox,\n    Recv: cc.EditBox,\n    LastCmdName: \"\", //最后发出的命令名\n    RecvCount: 0,\n    LabRecvCount: cc.Label,\n    GmJson: { default: null, type: cc.JsonAsset },\n    ScrollItem: cc.Prefab,\n    ScrollCmd: cc.ScrollView\n    //GmConfig: new AConfig()\n  },\n\n  netEvent: function(event, msg) {\n    //这里处理游戏来的所有事件\n    /*\n    if (event == XOpcodes.XC_NET_CONNECTED) {\n      this.auth();\n      return;\n    }*/\n    let cmdline = JSON.stringify(msg);\n    if (event == \"GX_APP_BUILD_MSG\") {\n      this.TxLog.string = msg.text;\n    }\n    console.log(\"netEvent:\" + JSON.stringify(msg));\n    if (msg.cmd === this.LastCmdName + \"_R\") {\n      this.CmdResult.string = cmdline;\n    }\n\n    this.Recv.string = cmdline;\n    this.RecvCount++;\n    this.LabRecvCount.string = \"接收数据:\" + this.RecvCount.toString();\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n  _onGmCmdClick(tar, cmdline, note) {\n    console.log(\"_onGmCmdClick:\" + cmdline);\n    tar.CmdSend.string = cmdline;\n    tar.CmdResult.string = note;\n  },\n\n  GmInsert(title, cmdline, note) {\n    var item = cc.instantiate(this.ScrollItem);\n    //这里是脚本组件的名字\n    //item.getComponent(\"RankItem\").init(i, playerInfo);\n    let sc = item.getComponent(\"ScriptGmCmd\");\n    if (sc) {\n      sc.SetData(this._onGmCmdClick, this, title, cmdline, note); //.bind(this);\n    }\n    this.ScrollCmd.content.addChild(item);\n  },\n\n  onLoad() {\n    XNet.EarAdd(this);\n\n    /*    \n    for (var i = 0; i < 20; i++) {\n      var item = cc.instantiate(this.ScrollItem);\n      //这里是脚本组件的名字\n      //item.getComponent(\"RankItem\").init(i, playerInfo);\n      let sc = item.getComponent(\"ScriptGmCmd\");\n      if (sc) {\n        sc.SetData(this._onGmCmdClick, this, \"echo\" + i, \"echo\" + i, \"echo\"); //.bind(this);\n      }\n      this.ScrollCmd.content.addChild(item);\n      console.log(\"++:\" + i.toString());\n    }\n*/\n\n    cc.loader.loadRes(\n      \"db/gm_cmd\",\n      function(err, jsonAsset) {\n        this.GmJson = jsonAsset;\n        //console.log(JSON.stringify(jsonAsset.json));\n        this._onAfterGmJsonDBLoaded();\n      }.bind(this)\n    );\n\n    //this.GmConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\n    AConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\n  },\n\n  _onAfterGmConfig(arg) {\n    let v = AConfig.RowFeildValueFirstEx(\"ID\", \"10001\", \"NAME\");\n    console.log(\"++++++++++++++\" + v);\n    for (let i = 0; i < AConfig.Count(); i++) {\n      let o = AConfig.RowObject(i);\n      if (o) {\n        arg.GmInsert(o.NAME, o.CMDLINE, o.NOTE);\n      }\n    }\n  },\n\n  start() {},\n\n  _onAfterGmJsonDBLoaded() {\n    if (this.GmJson) {\n      //console.log(JSON.stringify(this.GmJson.json));\n      if (Array.isArray(this.GmJson.json)) {\n        //this.GmJson.json.forEach(function(item, index, array)\n        for (let i = 0; i < this.GmJson.json.length; i++) {\n          //console.log(item, index);\n          let j = this.GmJson.json[i];\n          console.log(JSON.stringify(j));\n        }\n      }\n    }\n  },\n\n  // update (dt) {},\n\n  ClickConnect() {\n    if (this.WsHost.string.length < 1) {\n      return;\n    }\n    XNet.Close();\n    XNet.Host(\"ws://test.9966886699.com:8086/xx\");\n    XNet.Open();\n    /*\n    this.CmdWait = {\n      cmd: \"GX_APP_UPGRADE\",\n      ver: this.Version.string,\n      app: \"XX\"\n    };\n    */\n  },\n  ClickDisconnect() {\n    XNet.Close();\n  },\n  //服务器连接库\n  ClickWsLibrary() {},\n\n  //发出命令\n  ClickCmdSend() {\n    let cmdline = this.CmdSend.string;\n    console.log(\"cmdline:\" + cmdline);\n    try {\n      let msg = JSON.parse(cmdline);\n      this.LastCmdName = msg.cmd;\n      XNet.Send(cmdline);\n    } catch (e) {\n      this.CmdResult.string = e.message;\n    }\n  },\n\n  //\n  ClickScrollItem() {\n    //看属于行  json instanceof JSONArray\n  }\n});\n"]}