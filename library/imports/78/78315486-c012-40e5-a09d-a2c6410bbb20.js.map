{"version":3,"sources":["../../../../assets/Script/assets/Script/Gm.js"],"names":["AConfig","require","cc","Class","extends","Component","properties","Info","Label","WsHost","EditBox","CmdSend","CmdResult","Recv","LastCmdName","RecvCount","LabRecvCount","GmJson","default","type","JsonAsset","ScrollItem","Prefab","ScrollCmd","ScrollView","netEvent","event","msg","cmdline","JSON","stringify","TxLog","string","text","console","log","cmd","toString","_onGmCmdClick","tar","note","GmInsert","title","item","instantiate","sc","getComponent","SetData","content","addChild","onLoad","XGame","username","password","XNet","EarAdd","loader","loadRes","err","jsonAsset","_onAfterGmJsonDBLoaded","bind","LoadFromFile","_onAfterGmConfig","arg","v","RowFeildValueFirstEx","i","Count","o","RowObject","NAME","CMDLINE","NOTE","start","Array","isArray","json","length","j","ClickConnect","Close","Host","Open","ClickDisconnect","ClickWsLibrary","ClickCmdSend","parse","Send","e","message","ClickScrollItem"],"mappings":"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","file":"Gm.js","sourceRoot":"../../../../assets/Script","sourcesContent":["import { XNet, XNetEvent } from \"./Network\";\nimport { XGame } from \"./Game\";\n\n//import \"./Config\";\nvar AConfig = require(\"Config\");\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    Info: cc.Label,\n    WsHost: cc.EditBox,\n    CmdSend: cc.EditBox,\n    CmdResult: cc.EditBox,\n    Recv: cc.EditBox,\n    LastCmdName: \"\", //最后发出的命令名\n    RecvCount: 0,\n    LabRecvCount: cc.Label,\n    GmJson: { default: null, type: cc.JsonAsset },\n    ScrollItem: cc.Prefab,\n    ScrollCmd: cc.ScrollView\n    //GmConfig: new AConfig()\n  },\n\n  netEvent: function(event, msg) {\n    //这里处理游戏来的所有事件\n    /*\n    if (event == XOpcodes.XC_NET_CONNECTED) {\n      this.auth();\n      return;\n    }*/\n    let cmdline = JSON.stringify(msg);\n    if (event == \"GX_APP_BUILD_MSG\") {\n      this.TxLog.string = msg.text;\n    }\n    console.log(\"netEvent:\" + JSON.stringify(msg));\n    if (msg.cmd === this.LastCmdName + \"_R\") {\n      this.CmdResult.string = cmdline;\n    }\n\n    this.Recv.string = cmdline;\n    this.RecvCount++;\n    this.LabRecvCount.string = \"接收数据:\" + this.RecvCount.toString();\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n  _onGmCmdClick(tar, cmdline, note) {\n    console.log(\"_onGmCmdClick:\" + cmdline);\n    tar.CmdSend.string = cmdline;\n    tar.CmdResult.string = note;\n  },\n\n  GmInsert(title, cmdline, note) {\n    var item = cc.instantiate(this.ScrollItem);\n    //这里是脚本组件的名字\n    //item.getComponent(\"RankItem\").init(i, playerInfo);\n    let sc = item.getComponent(\"ScriptGmCmd\");\n    if (sc) {\n      sc.SetData(this._onGmCmdClick, this, title, cmdline, note); //.bind(this);\n    }\n    this.ScrollCmd.content.addChild(item);\n  },\n\n  onLoad() {\n    this.Info.string = \"ud=\" + XGame.username + \":\" + XGame.password;\n\n    XNet.EarAdd(this);\n\n    /*    \n    for (var i = 0; i < 20; i++) {\n      var item = cc.instantiate(this.ScrollItem);\n      //这里是脚本组件的名字\n      //item.getComponent(\"RankItem\").init(i, playerInfo);\n      let sc = item.getComponent(\"ScriptGmCmd\");\n      if (sc) {\n        sc.SetData(this._onGmCmdClick, this, \"echo\" + i, \"echo\" + i, \"echo\"); //.bind(this);\n      }\n      this.ScrollCmd.content.addChild(item);\n      console.log(\"++:\" + i.toString());\n    }\n*/\n\n    cc.loader.loadRes(\n      \"db/gm_cmd\",\n      function(err, jsonAsset) {\n        this.GmJson = jsonAsset;\n        //console.log(JSON.stringify(jsonAsset.json));\n        this._onAfterGmJsonDBLoaded();\n      }.bind(this)\n    );\n\n    //this.GmConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\n    AConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\n  },\n\n  _onAfterGmConfig(arg) {\n    let v = AConfig.RowFeildValueFirstEx(\"ID\", \"10001\", \"NAME\");\n    console.log(\"++++++++++++++\" + v);\n    for (let i = 0; i < AConfig.Count(); i++) {\n      let o = AConfig.RowObject(i);\n      if (o) {\n        arg.GmInsert(o.NAME, o.CMDLINE, o.NOTE);\n      }\n    }\n  },\n\n  start() {},\n\n  _onAfterGmJsonDBLoaded() {\n    if (this.GmJson) {\n      //console.log(JSON.stringify(this.GmJson.json));\n      if (Array.isArray(this.GmJson.json)) {\n        //this.GmJson.json.forEach(function(item, index, array)\n        for (let i = 0; i < this.GmJson.json.length; i++) {\n          //console.log(item, index);\n          let j = this.GmJson.json[i];\n          console.log(JSON.stringify(j));\n        }\n      }\n    }\n  },\n\n  // update (dt) {},\n\n  ClickConnect() {\n    if (this.WsHost.string.length < 1) {\n      return;\n    }\n    XNet.Close();\n    XNet.Host(\"ws://test.9966886699.com:8086/xx\");\n    XNet.Open();\n    /*\n    this.CmdWait = {\n      cmd: \"GX_APP_UPGRADE\",\n      ver: this.Version.string,\n      app: \"XX\"\n    };\n    */\n  },\n  ClickDisconnect() {\n    XNet.Close();\n  },\n  //服务器连接库\n  ClickWsLibrary() {},\n\n  //发出命令\n  ClickCmdSend() {\n    let cmdline = this.CmdSend.string;\n    console.log(\"cmdline:\" + cmdline);\n    try {\n      let msg = JSON.parse(cmdline);\n      this.LastCmdName = msg.cmd;\n      XNet.Send(cmdline);\n    } catch (e) {\n      this.CmdResult.string = e.message;\n    }\n  },\n\n  //\n  ClickScrollItem() {\n    //看属于行  json instanceof JSONArray\n  }\n});\n"]}