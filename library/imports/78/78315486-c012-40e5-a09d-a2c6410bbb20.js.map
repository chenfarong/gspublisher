{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Gm.js"],"names":["AConfig","require","cc","Class","extends","Component","properties","Info","Label","WsHost","EditBox","CmdSend","CmdResult","Recv","LastCmdName","RecvCount","LabRecvCount","GmJson","default","type","JsonAsset","ScrollItem","Prefab","ScrollCmd","ScrollView","netEvent","event","msg","cmdline","JSON","stringify","TxLog","string","text","console","log","cmd","toString","_onGmCmdClick","tar","note","GmInsert","title","item","instantiate","sc","getComponent","SetData","content","addChild","onLoad","XGame","username","password","XNet","EarAdd","loader","loadRes","err","jsonAsset","_onAfterGmJsonDBLoaded","bind","LoadFromFile","_onAfterGmConfig","arg","v","RowFeildValueFirstEx","i","Count","o","RowObject","NAME","CMDLINE","NOTE","start","Array","isArray","json","length","j","ClickConnect","Host","Open","ClickDisconnect","Close","ClickWsLibrary","ClickCmdSend","parse","Send","e","message","ClickScrollItem"],"mappings":"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","file":"Gm.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import { XNet, XNetEvent } from \"./Network\";\r\nimport { XGame } from \"./Game\";\r\n\r\n//import \"./Config\";\r\nvar AConfig = require(\"Config\");\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    Info: cc.Label,\r\n    WsHost: cc.EditBox,\r\n    CmdSend: cc.EditBox,\r\n    CmdResult: cc.EditBox,\r\n    Recv: cc.EditBox,\r\n    LastCmdName: \"\", //最后发出的命令名\r\n    RecvCount: 0,\r\n    LabRecvCount: cc.Label,\r\n    GmJson: { default: null, type: cc.JsonAsset },\r\n    ScrollItem: cc.Prefab,\r\n    ScrollCmd: cc.ScrollView\r\n    //GmConfig: new AConfig()\r\n  },\r\n\r\n  netEvent: function(event, msg) {\r\n    //这里处理游戏来的所有事件\r\n    /*\r\n    if (event == XOpcodes.XC_NET_CONNECTED) {\r\n      this.auth();\r\n      return;\r\n    }*/\r\n    let cmdline = JSON.stringify(msg);\r\n    if (event == \"GX_APP_BUILD_MSG\") {\r\n      this.TxLog.string = msg.text;\r\n    }\r\n    console.log(\"netEvent:\" + JSON.stringify(msg));\r\n    if (msg.cmd === this.LastCmdName + \"_R\") {\r\n      this.CmdResult.string = cmdline;\r\n    }\r\n\r\n    this.Recv.string = cmdline;\r\n    this.RecvCount++;\r\n    this.LabRecvCount.string = \"接收数据:\" + this.RecvCount.toString();\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n  _onGmCmdClick(tar, cmdline, note) {\r\n    console.log(\"_onGmCmdClick:\" + cmdline);\r\n    tar.CmdSend.string = cmdline;\r\n    tar.CmdResult.string = note;\r\n  },\r\n\r\n  GmInsert(title, cmdline, note) {\r\n    var item = cc.instantiate(this.ScrollItem);\r\n    //这里是脚本组件的名字\r\n    //item.getComponent(\"RankItem\").init(i, playerInfo);\r\n    let sc = item.getComponent(\"ScriptGmCmd\");\r\n    if (sc) {\r\n      sc.SetData(this._onGmCmdClick, this, title, cmdline, note); //.bind(this);\r\n    }\r\n    this.ScrollCmd.content.addChild(item);\r\n  },\r\n\r\n  onLoad() {\r\n    this.Info.string = \"ud=\" + XGame.username + \":\" + XGame.password;\r\n\r\n    XNet.EarAdd(this);\r\n\r\n    /*    \r\n    for (var i = 0; i < 20; i++) {\r\n      var item = cc.instantiate(this.ScrollItem);\r\n      //这里是脚本组件的名字\r\n      //item.getComponent(\"RankItem\").init(i, playerInfo);\r\n      let sc = item.getComponent(\"ScriptGmCmd\");\r\n      if (sc) {\r\n        sc.SetData(this._onGmCmdClick, this, \"echo\" + i, \"echo\" + i, \"echo\"); //.bind(this);\r\n      }\r\n      this.ScrollCmd.content.addChild(item);\r\n      console.log(\"++:\" + i.toString());\r\n    }\r\n*/\r\n\r\n    cc.loader.loadRes(\r\n      \"db/gm_cmd\",\r\n      function(err, jsonAsset) {\r\n        this.GmJson = jsonAsset;\r\n        //console.log(JSON.stringify(jsonAsset.json));\r\n        this._onAfterGmJsonDBLoaded();\r\n      }.bind(this)\r\n    );\r\n\r\n    //this.GmConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\r\n    AConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\r\n  },\r\n\r\n  _onAfterGmConfig(arg) {\r\n    let v = AConfig.RowFeildValueFirstEx(\"ID\", \"10001\", \"NAME\");\r\n    console.log(\"++++++++++++++\" + v);\r\n    for (let i = 0; i < AConfig.Count(); i++) {\r\n      let o = AConfig.RowObject(i);\r\n      if (o) {\r\n        arg.GmInsert(o.NAME, o.CMDLINE, o.NOTE);\r\n      }\r\n    }\r\n  },\r\n\r\n  start() {},\r\n\r\n  _onAfterGmJsonDBLoaded() {\r\n    if (this.GmJson) {\r\n      //console.log(JSON.stringify(this.GmJson.json));\r\n      if (Array.isArray(this.GmJson.json)) {\r\n        //this.GmJson.json.forEach(function(item, index, array)\r\n        for (let i = 0; i < this.GmJson.json.length; i++) {\r\n          //console.log(item, index);\r\n          let j = this.GmJson.json[i];\r\n          console.log(JSON.stringify(j));\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  // update (dt) {},\r\n\r\n  ClickConnect() {\r\n    if (this.WsHost.string.length < 1) {\r\n      return;\r\n    }\r\n    //XNet.Close();\r\n    XNet.Host(\"ws://test.9966886699.com:8086/xx\");\r\n    XNet.Open();\r\n    /*\r\n    this.CmdWait = {\r\n      cmd: \"GX_APP_UPGRADE\",\r\n      ver: this.Version.string,\r\n      app: \"XX\"\r\n    };\r\n    */\r\n  },\r\n  ClickDisconnect() {\r\n    XNet.Close();\r\n  },\r\n  //服务器连接库\r\n  ClickWsLibrary() {},\r\n\r\n  //发出命令\r\n  ClickCmdSend() {\r\n    let cmdline = this.CmdSend.string;\r\n    console.log(\"cmdline:\" + cmdline);\r\n    try {\r\n      let msg = JSON.parse(cmdline);\r\n      this.LastCmdName = msg.cmd;\r\n      XNet.Send(cmdline);\r\n    } catch (e) {\r\n      this.CmdResult.string = e.message;\r\n    }\r\n  },\r\n\r\n  //\r\n  ClickScrollItem() {\r\n    //看属于行  json instanceof JSONArray\r\n  }\r\n});\r\n"]}