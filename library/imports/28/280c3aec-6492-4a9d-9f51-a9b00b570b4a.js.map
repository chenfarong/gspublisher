{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Home.js"],"names":["cc","Class","extends","Component","properties","label","default","type","Label","labXhr","NetReady","appVer","EditBox","netEvListener","netMsgListener","CmdWait","text","tipsPrefab","Prefab","ShowStory","netEvent","event","msg","string","console","log","JSON","stringify","netSocketEvent","target","cmd","XNetEvent","CONNECTED","XNet","Send","CONNECT_TIMEOUT","CONNECT_ERROR","CONNECT","ws_host","director","getScheduler","schedule","ConnectCheck","_onAfterGetXMLHttpRequest","xhr","responseText","UpdateGamePort","_xhrXHR","cav","getScene","getChildByName","xlab","getComponent","loader","getXMLHttpRequest","onreadystatechange","readyState","status","anim","Animation","play","open","timeout","send","UpdateGamePort1","setRequestHeader","response","jsonData","parse","code","onLoad","callback","netMsgProc","EarAdd","ListenerAdd","start","update","dt","clickGameSwitch","createTips","content","n","instantiate","tipsCtrl","setContent","parent","ClickAppBuild","ver","app","Close","Host","Open","ClickAppUpgradeTest","ClickAppUpgradeAudit","ClickGamePortWhere"],"mappings":"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","file":"Home.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["//const TipsManager = require(\"./TipsManager.js\"); //浏览器会有问题\r\nimport { XNet, XNetEvent } from \"./Network\";\r\n//import { TipsManager } from \"./TipsManager\";\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    label: {\r\n      default: null,\r\n      type: cc.Label\r\n    },\r\n    labXhr: cc.Label,\r\n    NetReady: false,\r\n    appVer: cc.EditBox,\r\n    netEvListener: null,\r\n    netMsgListener: null,\r\n    CmdWait: null,\r\n    // defaults, set visually when attaching this script to the Canvas\r\n    text: \"准备就绪\",\r\n    tipsPrefab: cc.Prefab\r\n  },\r\n\r\n  ShowStory: function() {},\r\n\r\n  netEvent: function(event, msg) {\r\n    //这里处理游戏来的所有事件\r\n    if (event == \"GX_APP_BUILD_MSG\") {\r\n      this.label.string = msg.text;\r\n    }\r\n    console.log(\"netEvent:\" + JSON.stringify(msg));\r\n  },\r\n\r\n  netSocketEvent: function(msg, target) {\r\n    if (msg.cmd == XNetEvent.CONNECTED) {\r\n      //      target.WsHost.string = XNet.ws_host;\r\n      //      target.WsHost.node.color = cc.color(0, 255, 0, 100);\r\n      //      target.WsHost.node.opacity = 255;\r\n      target.NetReady = true;\r\n\r\n      if (target.CmdWait) {\r\n        XNet.Send(JSON.stringify(target.CmdWait));\r\n      }\r\n    }\r\n\r\n    if (\r\n      msg.cmd == XNetEvent.CONNECT_TIMEOUT ||\r\n      msg.cmd == XNetEvent.CONNECT_ERROR\r\n    ) {\r\n      target.label.string = \"网络连接错误\";\r\n    }\r\n\r\n    if (msg.cmd == XNetEvent.CONNECT) {\r\n      target.label.string = \"连接->\" + XNet.ws_host;\r\n      cc.director\r\n        .getScheduler()\r\n        .schedule(target.ConnectCheck, target, 6, 1, 6, false);\r\n    }\r\n  },\r\n\r\n  ConnectCheck: function() {\r\n    XNet.ConnectCheck(false);\r\n  },\r\n\r\n  _onAfterGetXMLHttpRequest: function(xhr) {\r\n    if (this.label) {\r\n      this.label.string = \"recv:\" + xhr.responseText;\r\n    }\r\n  },\r\n\r\n  UpdateGamePort: function() {\r\n    this._xhrXHR = null;\r\n    /*\r\n    cc.loader.load(\r\n      {\r\n        url: \"http://xxgame.9966886699.com/where.php?v=10800&p=1000&\",\r\n        type: \"json\"\r\n      },\r\n      function(err, text) {\r\n        console.log(\r\n          \"Should load a texture from RESTful API by specify the type: \",\r\n          text\r\n        );\r\n      }\r\n    );\r\n    */\r\n\r\n    let cav = cc.director.getScene().getChildByName(\"Canvas\");\r\n    let label = cav.getChildByName(\"LabelGamePort\");\r\n    if (label) {\r\n      let xlab = label.getComponent(cc.Label);\r\n      if (xlab) {\r\n        xlab.string = \"\";\r\n      }\r\n    }\r\n\r\n    var xhr = cc.loader.getXMLHttpRequest();\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 207)) {\r\n        console.log(\"recv:\" + xhr.responseText);\r\n\r\n        if (label) {\r\n          let anim = label.getComponent(cc.Animation);\r\n          if (anim) {\r\n            anim.play(\"labGamePort\");\r\n          }\r\n          //label.node.color = cc.color(0, 255, 0, 255);\r\n          //label.node.visible = false;\r\n          let xlab = label.getComponent(cc.Label);\r\n          if (xlab) {\r\n            xlab.string = xhr.responseText;\r\n            console.log(\"========\" + label.string);\r\n          }\r\n        }\r\n        //this._onAfterGetXMLHttpRequest(xhr);\r\n      }\r\n    };\r\n    xhr.open(\"GET\", \"http://xxgame.9966886699.com/where.php?v=10800&p=1000&\");\r\n    xhr.timeout = 5000; //5 seconds for timeout\r\n    xhr.send();\r\n    this._xhrXHR = xhr;\r\n  },\r\n\r\n  UpdateGamePort1: function() {\r\n    var xhr = cc.loader.getXMLHttpRequest();\r\n    //    this.streamXHREventsToLabel(xhr, this.xhr, this.xhr, \"GET\");\r\n    //    var xhr = cc.loader.getXMLHttpRequest();\r\n\r\n    //xhr.open(\"GET\", url);\r\n    xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 207)) {\r\n        var response = xhr.responseText;\r\n        console.log(\"recv:\" + xhr.responseText);\r\n        //this.xhr.string = xhr.responseText;\r\n        //json 解析\r\n        var jsonData = JSON.parse(response);\r\n        var code = jsonData[\"code\"];\r\n        if (code == 1) {\r\n          //                self.successSprite.getComponent(cc.Animation).play('resAnimate');\r\n        }\r\n      }\r\n    };\r\n\r\n    xhr.open(\"GET\", \"http://xxgame.9966886699.com/where.php?v=10800&p=1000&\");\r\n    //set Content-type \"text/plain\" to post ArrayBuffer or ArrayBufferView\r\n    //xhr.setRequestHeader(\"Content-Type\",\"Application/json\");\r\n    // Uint8Array is an ArrayBufferView\r\n    xhr.timeout = 5000; //5 seconds for timeout\r\n    xhr.send();\r\n  },\r\n\r\n  // use this for initialization\r\n  onLoad: function() {\r\n    this.label.string = this.text;\r\n\r\n    this.netEvListener = { callback: this.netSocketEvent, target: this };\r\n    this.netMsgListener = { callback: this.netMsgProc, target: this };\r\n\r\n    XNet.EarAdd(this);\r\n    XNet.ListenerAdd(XNetEvent.CONNECTED, this.netEvListener);\r\n    XNet.ListenerAdd(XNetEvent.CONNECT, this.netEvListener);\r\n    XNet.ListenerAdd(XNetEvent.CONNECT_ERROR, this.netEvListener);\r\n    XNet.ListenerAdd(XNetEvent.CONNECT_TIMEOUT, this.netEvListener);\r\n\r\n    this.UpdateGamePort();\r\n  },\r\n\r\n  start() {\r\n    //TipsManager.init();\r\n  },\r\n\r\n  // called every frame\r\n  update: function(dt) {},\r\n\r\n  clickGameSwitch() {\r\n    //TipsManager.createTips(\"还没实现\");\r\n    this.createTips(\"还没实现\");\r\n  },\r\n\r\n  createTips(content) {\r\n    var n = cc.instantiate(this.tipsPrefab);\r\n    if (n) {\r\n      let tipsCtrl = n.getComponent(\"TipsCtrl\");\r\n      if (content && tipsCtrl) {\r\n        tipsCtrl.setContent(content);\r\n      }\r\n      n.parent = cc.director.getScene();\r\n    }\r\n  },\r\n\r\n  ClickAppBuild() {\r\n    //let ver =  appVer.string;\r\n    this.CmdWait = {\r\n      cmd: \"GX_APP_BUILD\",\r\n      ver: this.appVer.string,\r\n      app: \"XX\"\r\n    };\r\n\r\n    XNet.Close();\r\n    XNet.Host(\"ws://192.168.1.99:3737/appPub\");\r\n    XNet.Open();\r\n\r\n    this.label.string = \"build:\" + this.appVer.string;\r\n  },\r\n\r\n  ClickAppUpgradeTest() {\r\n    XNet.Close();\r\n    XNet.Host(\"ws://test.9966886699.com:3737/appPub\");\r\n    XNet.Open();\r\n    this.CmdWait = {\r\n      cmd: \"GX_APP_UPGRADE\",\r\n      ver: this.appVer.string,\r\n      app: \"XX\"\r\n    };\r\n    this.label.string = \"test-upgrade:\" + this.appVer.string;\r\n  },\r\n\r\n  ClickAppUpgradeAudit() {\r\n    //TipsManager.createTips(\"还没实现\");\r\n    this.createTips(\"还没实现\");\r\n  },\r\n  ClickGamePortWhere() {\r\n    this.UpdateGamePort();\r\n  }\r\n});\r\n"]}