{"version":3,"sources":["Gm.js"],"names":["AConfig","require","cc","Class","extends","Component","properties","WsHost","EditBox","CmdSend","CmdResult","Recv","LastCmdName","RecvCount","LabRecvCount","Label","GmJson","default","type","JsonAsset","ScrollItem","Prefab","ScrollCmd","ScrollView","netEvent","event","msg","cmdline","JSON","stringify","TxLog","string","text","console","log","cmd","toString","_onGmCmdClick","tar","note","onLoad","XNet","EarAdd","i","item","instantiate","sc","getComponent","SetData","content","addChild","loader","loadRes","err","jsonAsset","_onAfterGmJsonDBLoaded","bind","LoadFromFile","_onAfterGmConfig","arg","v","RowFeildValueFirstEx","start","Array","isArray","json","length","j","ClickConnect","Close","Host","Open","ClickDisconnect","ClickWsLibrary","ClickCmdSend","parse","Send","e","message","ClickScrollItem"],"mappings":"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","file":"Gm.js","sourceRoot":"../../../../assets/Script","sourcesContent":["import { XNet, XNetEvent } from \"./Network\";\n//import \"./Config\";\nvar AConfig = require(\"Config\");\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    WsHost: cc.EditBox,\n    CmdSend: cc.EditBox,\n    CmdResult: cc.EditBox,\n    Recv: cc.EditBox,\n    LastCmdName: \"\", //最后发出的命令名\n    RecvCount: 0,\n    LabRecvCount: cc.Label,\n    GmJson: { default: null, type: cc.JsonAsset },\n    ScrollItem: cc.Prefab,\n    ScrollCmd: cc.ScrollView\n    //GmConfig: new AConfig()\n  },\n\n  netEvent: function(event, msg) {\n    //这里处理游戏来的所有事件\n    /*\n    if (event == XOpcodes.XC_NET_CONNECTED) {\n      this.auth();\n      return;\n    }*/\n    let cmdline = JSON.stringify(msg);\n    if (event == \"GX_APP_BUILD_MSG\") {\n      this.TxLog.string = msg.text;\n    }\n    console.log(\"netEvent:\" + JSON.stringify(msg));\n    if (msg.cmd === this.LastCmdName + \"_R\") {\n      this.CmdResult.string = cmdline;\n    }\n\n    this.Recv.string = cmdline;\n    this.RecvCount++;\n    this.LabRecvCount.string = \"接收数据:\" + this.RecvCount.toString();\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n  _onGmCmdClick(tar, cmdline, note) {\n    console.log(\"_onGmCmdClick:\" + cmdline);\n    tar.CmdSend.string = cmdline;\n  },\n\n  onLoad() {\n    XNet.EarAdd(this);\n\n    for (var i = 0; i < 20; i++) {\n      var item = cc.instantiate(this.ScrollItem);\n      //这里是脚本组件的名字\n      //item.getComponent(\"RankItem\").init(i, playerInfo);\n      let sc = item.getComponent(\"ScriptGmCmd\");\n      if (sc) {\n        sc.SetData(this._onGmCmdClick, this, \"echo\", \"echo\", \"echo\"); //.bind(this);\n      }\n      this.ScrollCmd.content.addChild(item);\n      console.log(\"++:\" + i.toString());\n    }\n\n    cc.loader.loadRes(\n      \"db/gm_cmd\",\n      function(err, jsonAsset) {\n        this.GmJson = jsonAsset;\n        //console.log(JSON.stringify(jsonAsset.json));\n        this._onAfterGmJsonDBLoaded();\n      }.bind(this)\n    );\n\n    //this.GmConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\n    AConfig.LoadFromFile(\"db/gm_cmd\", this._onAfterGmConfig, this);\n  },\n\n  _onAfterGmConfig(arg) {\n    let v = AConfig.RowFeildValueFirstEx(\"ID\", \"10001\", \"NAME\");\n    console.log(\"++++++++++++++\" + v);\n  },\n\n  start() {},\n\n  _onAfterGmJsonDBLoaded() {\n    if (this.GmJson) {\n      //console.log(JSON.stringify(this.GmJson.json));\n      if (Array.isArray(this.GmJson.json)) {\n        //this.GmJson.json.forEach(function(item, index, array)\n        for (let i = 0; i < this.GmJson.json.length; i++) {\n          //console.log(item, index);\n          let j = this.GmJson.json[i];\n          console.log(JSON.stringify(j));\n        }\n      }\n    }\n  },\n\n  // update (dt) {},\n\n  ClickConnect() {\n    if (this.WsHost.string.length < 1) {\n      return;\n    }\n    XNet.Close();\n    XNet.Host(\"ws://test.9966886699.com:8086/xx\");\n    XNet.Open();\n    /*\n    this.CmdWait = {\n      cmd: \"GX_APP_UPGRADE\",\n      ver: this.Version.string,\n      app: \"XX\"\n    };\n    */\n  },\n  ClickDisconnect() {\n    XNet.Close();\n  },\n  //服务器连接库\n  ClickWsLibrary() {},\n\n  //发出命令\n  ClickCmdSend() {\n    let cmdline = this.CmdSend.string;\n    console.log(\"cmdline:\" + cmdline);\n    try {\n      let msg = JSON.parse(cmdline);\n      this.LastCmdName = msg.cmd;\n      XNet.Send(cmdline);\n    } catch (e) {\n      this.CmdResult.string = e.message;\n    }\n  },\n\n  //\n  ClickScrollItem() {\n    //看属于行  json instanceof JSONArray\n  }\n});\n"]}