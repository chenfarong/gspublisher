{"version":3,"sources":["Game.js"],"names":["XGame","cc","Class","extends","Component","statics","clientVersion","resVersion","username","password","accid","aid","token","whereResult","sdtime","whereUrl","Where","callback","who","n","url","req","cmd","ver","realm","xhr","loader","getXMLHttpRequest","onreadystatechange","readyState","status","JSON","parse","responseText","open","timeout","ontimeout","console","error","send","stringify","Version","log","server","aver","Update","dt"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/resources","sourcesContent":["//import { XNet } from \"./Network\";\n\nvar XGame = cc.Class({\n  extends: cc.Component,\n  statics: {\n    clientVersion: 10000, //客户端程序版本号\n    resVersion: 10000, //资源版本号\n    username: \"\",\n    password: \"\",\n    accid: \"\", //账号\n    aid: \"\", //角色编号\n    token: \"\", //令牌\n    whereResult: {}, //游戏服务位置\n    sdtime: 0, //和服务器之间的时间差 毫秒\n\n    whereUrl: [\n      \"http://where.9966886699.com/xx/\",\n      \"http://where.9966886699.com/xx/\",\n      \"http://where.9966886699.com/xx/\"\n    ],\n\n    //向服务获取游戏服务器位置\n    Where: function(callback, who, n) {\n      n = n % 3;\n      let url = \"http://where.9966886699.com/xx/\";\n      url = this.whereUrl[n];\n\n      //从位置中心查询游戏服务器位置 http post 获得\n      let req = {};\n      req.cmd = \"GX_WHERE\";\n      req.ver = \"1000\";\n      req.realm = \"android\";\n      //XNet.HttpPost(\"http://where.9966886699.com/xx/\", req);\n      var xhr = cc.loader.getXMLHttpRequest();\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState === 4) {\n          //console.log(\"recv:\" + xhr.responseText);\n          if (xhr.status === 200) {\n            //收到内容后处理\n            XGame.whereResult = JSON.parse(xhr.responseText);\n            //console.log(\"====\", JSON.stringify(XGame.whereResult));\n            callback(who, xhr.responseText);\n          } else {\n            callback(who, null);\n          }\n        }\n      };\n      xhr.open(\"POST\", url);\n      xhr.timeout = 5000; //5 seconds for timeout\n      xhr.ontimeout = () => {\n        console.error(\"Timeout!!\");\n        callback(who, null);\n      };\n\n      xhr.send(JSON.stringify(req));\n    },\n\n    //向游戏服务器查询版本号\n    Version: function(callback, who) {\n      console.log(JSON.stringify(XGame.whereResult));\n\n      let url = \"http://where.9966886699.com/xx/\";\n      url = \"http://\" + XGame.whereResult.server[0] + \"/version\";\n      console.log(\"Version\", url);\n\n      //发送请求版本命令\n      let req = {};\n      req.cmd = \"GX_VERSION\";\n      req.aver = 1000;\n      var xhr = cc.loader.getXMLHttpRequest();\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState === 4) {\n          console.log(\"recv:\" + xhr.responseText);\n          if (xhr.status === 200) {\n            //收到内容后处理\n            //XGame.whereResult = JSON.parse(xhr.responseText);\n            //console.log(\"====\", JSON.stringify(XGame.whereResult));\n            callback(who, xhr.responseText);\n          } else {\n            callback(who, null);\n          }\n        }\n      };\n      xhr.open(\"POST\", url);\n      xhr.timeout = 5000; //5 seconds for timeout\n      xhr.ontimeout = () => {\n        console.error(\"Timeout!!\");\n        callback(who, null);\n      };\n\n      xhr.send(JSON.stringify(req));\n    },\n\n    //这里实现逻辑帧\n    //dt 上一帧到本帧时间差\n    Update: function(dt) {}\n  }\n});\n\nexport { XGame };\n"]}